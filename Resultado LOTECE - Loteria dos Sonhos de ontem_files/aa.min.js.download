"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var firebaseConfig={apiKey:"AIzaSyA-o3EXpQwwrT585Yp74_xd3TlPfaNHhEg",authDomain:"resultadofacil-4473f.firebaseapp.com",projectId:"resultadofacil-4473f",storageBucket:"resultadofacil-4473f.appspot.com",messagingSenderId:"565380276796",appId:"1:565380276796:web:41df8844d52d44b720d939",measurementId:"G-C1EW8FTLXT"},gacint=!1;function refreshPerfil(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"usuário",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/images/users/anonymous.jpg",e=e&&0<e.split(" ").length?e.split(" ")[0]:"";document.querySelector("#menu-perfil .first-name").textContent=e||"usuário",document.querySelector("#navitem-perfil img").src=t||"/images/users/anonymous.jpg"}function setUserAnonymous(){refreshPerfil(),$("#btn_logout").addClass("hidden"),$("#btn_login").removeClass("hidden"),showDivLock()}function getUserLocalstorage(){var e;return null!=localStorage.getItem("user_resultadofacil.com.br")?(e=JSON.parse(localStorage.getItem("user_resultadofacil.com.br"))).exp<(new Date).getTime()?firebase.auth().currentUser:e:null}function showOnetap(){initializeAccount(),google.accounts.id.prompt(logMomentNotification)}function initializeAccount(){gacint||(google.accounts.id.initialize({client_id:"565380276796-5ocp401d96ajnkvgjpfc42pegal030pe.apps.googleusercontent.com",callback:handleCredentialResponse}),gacint=!0)}function handleCredentialResponse(e){e=e.credential,e=(new firebase.auth.GoogleAuthProvider).credential(e);firebase.auth().signInWithCredential(e).then(function(e){e=e.user;setUserInfor(e),Swal.fire({icon:"success",title:"Logado com sucesso!",showConfirmButton:!1,timer:1500}),"function"==typeof get_&&get_(e)}).catch(function(e){Swal.fire({icon:"error",title:"Ocorreu um erro ao se conectar",text:"Nossa equipe já está resolvendo, em breve você receberá um e-mail informando sobre o problema.",showConfirmButton:!1,timer:1e4});var t=e.code,o=e.message;sendErr(e.email,"".concat(t," - ").concat(o))})}function setUserInfor(e){$("#btn_logout").removeClass("hidden"),$("#btn_login").addClass("hidden"),refreshPerfil(e.displayName,e.photoURL),hideDivLock()}function sendErr(e,t){var o=new FormData,e=(o.append("email",e),o.append("error",t),new XMLHttpRequest),t="".concat(window.location.origin,"/").concat(atob("cmVwb3J0LWVycm9yLWF1dGg="));e.open("POST",t,!0),e.send(o)}function setUserLocalstorage(t){t.getIdToken().then(function(e){e={displayName:t.displayName,photoURL:t.photoURL,tkn:e,exp:(new Date).getTime()+36e5};try{localStorage.setItem("user_resultadofacil.com.br",JSON.stringify(e))}catch(e){sendErr(t.email,message),console.error(e)}})}function signOut(){firebase.auth().signOut().then(function(){removeUserLocalstorage()}).catch(function(e){console.error(e)})}function removeUserLocalstorage(){localStorage.removeItem("user_resultadofacil.com.br"),setUserAnonymous()}function logMomentNotification(e){e.isDismissedMoment()||e.isSkippedMoment()&&(refreshPerfil(),e.getSkippedReason()&&e.getSkippedReason())}function buildSigninWithGoogle(){Swal.fire(_defineProperty({title:"<b>Conecte-se!</b>",html:'<p class="text-justify text-muted"">Para acessar o Resultado completo é necessário estar conectado. É muito simples e rápido, basta clicar no botão Fazer login e escolher sua conta:</p><div id="g_btn" style="display: inline-block;margin-top: 8px;"></div>',width:"36em",imageUrl:"/images/user169x169.png",allowEscapeKey:!1,backdrop:!1,allowOutsideClick:!1,showCloseButton:!1,showCancelButton:!1,showConfirmButton:!1},"showCloseButton",!0)),initializeAccount(),google.accounts.id.renderButton(document.getElementById("g_btn"),{type:"standard",locale:"pt_BR",size:"large"})}function hideDivLock(){$(".lock").hide()}function showDivLock(){$(".lock").show()}function onListenerAuthState(){firebase.auth().onAuthStateChanged(function(e){e?(console.debug("auth state: signed in"),setUserInfor(e),"function"==typeof get_&&get_(e)):(console.debug("auth state: signed out"),removeUserLocalstorage(),showOnetap())})}function storageAvailable(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"localStorage";try{var t=window[e],o="__storage_test__";return t.setItem(o,o),t.removeItem(o),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}firebase.initializeApp(firebaseConfig),location.hostname.startsWith("localhost")&&firebase.auth().useEmulator("http://localhost:9099"),document.getElementById("btn_logout").onclick=signOut,document.getElementById("btn_login").onclick=buildSigninWithGoogle,$(".lock .btn-dark").on("click",function(){buildSigninWithGoogle()}),onListenerAuthState();
"use strict";var saveToken,sendToServer,messaging;"Notification"in window&&"granted"===Notification.permission&&(saveToken=function(e){var o,n=localStorage.fcmToken,t=n!=e;""!=e&&(t&&(console.debug("token ["+n+"] <> token ["+e+"]"),console.debug("atualizando token ",n," para ",e),localStorage.fcmToken=e),(o=localStorage.topics?localStorage.topics.split(", "):[]).includes("OUTROS")||(o.push("OUTROS"),localStorage.topics=o.join(", ")),sendToServer(e,t?n:"",localStorage.topics))},sendToServer=function(o,e,n){var t,c,a;2==localStorage.topicsSycn?console.debug("nothing"):(""==n.trim()&&(n="OUTROS"),t="".concat(window.location.origin,"/").concat(atob("bWFuYWdlcnRvcGljcw==")),c={tfcm:o,topics:n,tfcmOld:e},self.fetch?fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)}).then(function(e){e&&(e.ok?(localStorage.topicsSycn=2,localStorage.fcmToken=o,console.debug("token sincronizado")):console.error("falha ao sincronizar token"))}).catch(function(e){console.error(e)}):((a=new XMLHttpRequest).open("POST",t,!0),a.setRequestHeader("Content-type","application/json"),a.onreadystatechange=function(){4==a.readyState&&200==a.status?(localStorage.topicsSycn=2,localStorage.fcmToken=o,console.debug(c)):console.error(c)},a.send(JSON.stringify(c))))},(messaging=firebase.messaging()).getToken().then(function(e){e?saveToken(e):console.debug("No Instance ID token available. Request permission to generate one.")}).catch(function(e){console.error("An error occurred while retrieving token. ",e)}),messaging.onTokenRefresh(function(){messaging.getToken().then(function(e){e&&(console.debug("Token refreshed: ",e),localStorage.topicsSycn=0,saveToken(e))}).catch(function(e){console.debug("Unable to retrieve refreshed token ",e)})}),$.fn.extend({fadeTo:function(){return this.each(function(){var e=this;if(0==this.style.opacity){for(var o=0;o<3e4;o++)this.style.opacity=o/3e4;var n=setTimeout(function(){e.style.opacity=0,clearTimeout(n)},1e4)}})}}),messaging.onMessage(function(e){var o=e.notification.click_action,n=(console.debug("Message received. ",e),$("#inner-message"));n&&(n.html(e.notification.title+', <a href="'+o+'" class="alert-link">clique para ver</a>'),n.fadeTo())}));